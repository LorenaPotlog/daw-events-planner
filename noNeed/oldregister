<?php
require __DIR__ . '/../src/bootstrap.php';
require __DIR__ . '/../config.php';
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
</head>
<body>
    <div>
        <?php
        if(isset($_POST['register'])){
        $firstname = $_POST['firstname'];
        $lastname  = $_POST['lastname'];
        $username  = $_POST['username'];
        $email     = $_POST['email'];
        $phone     = $_POST['phone'];
        $password  = $_POST['password'];

        //to change this
        $hashed_password = sha1($password);

        $query= "INSERT INTO users (firstname, lastname, username, email, phone, password ) VALUES (?,?,?,?,?,?)";

        if ($stmt = mysqli_prepare($link, $query)) {
            // Bind variables to the prepared statement as parameters
            mysqli_stmt_bind_param($stmt, "ssssss", $firstname, $lastname, $username, $email, $phone, $hashed_password);

            // Execute the prepared statement
            if (mysqli_stmt_execute($stmt)) {
                echo "Records inserted successfully.";

            } else {
                echo "ERROR: Could not execute query: $query. " . mysqli_error($link);
            }

            // Close statement
            mysqli_stmt_close($stmt);
        } else {
            echo "ERROR: Could not prepare query: $query. " . mysqli_error($link);
        }
        mysqli_free_result($result);
        mysqli_close($link);

}
?>
    </div>
<main>
    <form action="register.php" method="post">
        <h1>Sign Up</h1>
        <div>
            <label for="firstname">First name:</label>
            <input type="text" name="firstname" id="firstname">
        </div>
        <div>
            <label for="lastname">Last name:</label>
            <input type="text" name="lastname" id="lastname">
        </div>
        <div>
            <label for="username">Username:</label>
            <input type="text" name="username" id="username">
        </div>
        <div>
            <label for="email">Email:</label>
            <input type="email" name="email" id="email">
        </div>
        <div>
            <label for="phone">Phone number:</label>
            <input type="text" name="phone" id="phone">
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" name="password" id="password">
        </div>
        <div>
            <label for="password2">Password Again:</label>
            <input type="password" name="password2" id="password2">
        </div>
        <div>
            <label for="agree">
                <input type="checkbox" name="agree" id="agree" value="yes"/> I agree
                with the
                <a href="#" title="term of services">term of services</a>
            </label>
        </div>
        <button type="submit" name="register">Register</button>
        <footer>Already a member? <a href="../authenticate.php">Login here</a></footer>
    </form>
</main>
</body>
</html>